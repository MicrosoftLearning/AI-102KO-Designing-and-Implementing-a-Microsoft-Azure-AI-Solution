---
lab:
    title: 'Language 서비스를 사용하여 Language Understanding 모델 만들기(미리 보기)'
---

# Language 서비스를 사용하여 Language Understanding 모델 만들기(미리 보기)

> **참고**: Language 서비스의 대화형 Language Understanding 기능은 현재 미리 보기 상태이며 변경될 수 있습니다. 그리고 모델 학습이 실패하는 경우도 있는데, 그러면 학습을 다시 시도해야 합니다.  

Language 서비스에서는 *대화형 Language Understanding* 모델을 정의할 수 있습니다. 애플리케이션은 이 모델을 통해 사용자의 자연어 입력을 해석하고, 사용자의 의도(사용자가 달성하려는 목표)를 예측하고, 해당 의도를 적용해야 하는 엔터티를 식별할 수 있습니다.

예를 들어 시계 애플리케이션용 Language Understanding 모델은 다음과 같은 입력을 처리할 수 있습니다.

*What is the time in London?*

이러한 입력 유형의 예가 *발화*(사용자가 말하거나 입력하는 내용)입니다. 이 발화에서 원하는 *의도*는 특정 위치(*엔터티*), 즉 여기서는 런던의 시간을 확인하는 것입니다.

> **참고**: Language Understanding 모델은 사용자 의도를 예측하여 해당 의도가 적용되는 엔터티를 식별하는 작업을 수행합니다. 하지만 의도를 충족하는 데 필요한 작업을 실제로 수행하지는 <u>않습니다</u>. 예를 들어 시계 애플리케이션은 언어 앱을 사용해 사용자가 런던의 시간을 확인하려 한다는 것을 파악할 수는 있습니다. 그러나 이처럼 의도가 파악되고 나면 클라이언트 애플리케이션 자체가 논리를 구현해 정확한 시간을 확인하여 사용자에게 표시해야 합니다.

## Language 서비스 리소스 만들기

대화형 Language Understanding 모델을 만들려면 지원되는 지역의 **Language 서비스** 리소스가 필요합니다. 이 문서 작성 시점에는 미국 서부 2 및 서유럽 지역만 지원됩니다.

1. Azure Portal(`https://portal.azure.com`) 을 열고 Azure 구독과 연결된 Microsoft 계정을 사용하여 로그인합니다.
2. **&#65291;리소스 만들기** 단추를 선택하고 *language*를 검색한 후에 다음 설정을 사용하여 **Language 서비스** 리소스를 만듭니다.

    - **구독**: *사용자의 Azure 구독*
    - **리소스 그룹**: *리소스 그룹 선택 또는 만들기(제한된 구독을 사용 중이라면 새 리소스 그룹을 만들 권한이 없을 수도 있으므로 제공된 리소스 그룹 사용)*
    - **지역**: 미국 서부 2 또는 서유럽
    - **이름**: *고유한 이름 입력*
    - **가격 책정 계층**: 무료(F0)(*이 계층을 사용할 수 없으면 표준(S) 선택*)
    - **약관**: _동의_ 
    - **책임 있는 AI 알림**: _동의_
3. 배포가 완료될 때까지 기다렸다가 배포 세부 정보를 확인합니다.

## 대화형 Language Understanding 프로젝트 만들기

이제 작성 리소스를 만들었으므로 해당 리소스를 사용하여 대화형 Language Understanding 프로젝트를 만들 수 있습니다.

1. 새 브라우저 탭에서 Language Studio 포털 `https://language.azure.com` 을 열고 Azure 구독과 연결된 Microsoft 계정을 사용하여 로그인합니다.
2. Language 리소스 선택 메시지가 표시되면 다음 설정을 선택합니다.
    - **Azure Directory**: 구독이 포함된 Azure 디렉터리
    - **Azure 구독**: Azure 구독.
    - **Language** 리소스: 앞에서 만든 Language 리소스
3. Language 리소스를 선택하라는 메시지가 표시되지 <u>않으면</u> 다른 Language 리소스가 이미 할당되었기 때문일 수 있습니다. 이 경우에는 다음 단계를 수행합니다.
    1. 페이지 위쪽 표시줄에서 **설정(&#9881;)** 단추를 클릭합니다.
    2. **설정** 페이지에서 **리소스** 탭을 확인합니다.
    3. 앞에서 만든 Language 리소스를 선택하고 **리소스 전환**을 클릭합니다.
    4. 페이지 위쪽에서 **Language Studio**를 클릭하여 Language Studio 홈 페이지로 돌아옵니다.
4. 포털 위쪽의 **새로 만들기** 메뉴에서 **대화형 Language Understanding**을 선택합니다.
5. **프로젝트 만들기** 대화 상자의 **프로젝트 형식 선택** 페이지에서 **대화**를 선택하고 **다음**을 클릭합니다.
6. **기본 정보 입력** 페이지에서 다음 세부 정보를 입력하고 **다음:**을 클릭합니다.
    - **이름**: `Clock`
    - **설명**: `Natural language clock`
    - **발화 기본 언어**: 영어
    - **프로젝트에서 여러 언어를 사용하시겠습니까?**: *선택 안 함*
7. **검토 후 완료** 페이지에서 **만들기**를 클릭합니다.

## 의도 만들기

새 프로젝트에서는 먼저 몇 가지 의도를 정의합니다.

> **팁**: 프로젝트 사용 시에 팁이 표시되면 해당 내용을 확인한 후 **확인**을 클릭하여 팁 표시를 해제하거나 **모두 건너뛰기**를 클릭합니다.

1. **스키마 작성** 페이지의 **의도** 탭에서 **&#65291; 추가**를 선택하여 새 의도 **GetTime**을 추가합니다.
2. 새 **GetTime** 의도를 클릭한 다음 예제 사용자 입력으로 다음 발화를 추가해 의도를 편집합니다.

    `what is the time?`

    `what's the time?`

    `what time is it?`

    `tell me the time`

3. 이러한 발화를 추가한 후 **변경 내용 저장**을 클릭하고 **스키마 작성** 페이지로 돌아옵니다.

4. 다음 발화가 포함된 또 다른 새 의도 **GetDay**를 추가합니다.

    `what day is it?`

    `what's the day?`

    `what is the day today?`

    `what day of the week is it?`

5. 이러한 발화를 추가하고 저장한 후 **스키마 작성** 페이지로 돌아와서 다음 발화가 포함된 또 다른 새 의도 **GetDate**를 추가합니다.

    `what date is it?`

    `what's the date?`

    `what is the date today?`

    `what's today's date?`

6. 이러한 발화를 추가하고 저장한 후 발화 페이지에서 **GetDate** 필터를 해제합니다. 그러면 모든 의도의 발화를 모두 확인할 수 있습니다.

## 모델 학습 및 테스트

이제 몇 가지 의도를 추가했으므로 언어 모델을 학습시켜 사용자 입력에서 정확하게 예측을 할 수 있는지 확인해 보겠습니다.

1. 왼쪽 창에서 **모델 학습** 페이지를 선택하고 새 모델을 학습시키는 옵션을 선택합니다. 모델 이름은 **Clock**으로 지정하고, 학습 시 평가를 실행하는 옵션이 선택되어 있는지 확인합니다. **학습**을 클릭하여 모델을 학습시킵니다.
2. 학습이 완료되면(시간이 다소 걸릴 수 있음) **모델 세부 정보 보기** 페이지를 표시하고 **Clock** 모델을 선택합니다. 그런 다음 학습 시 수행된 평가에서 생성된 *오차 행렬*, 그리고 평가 전반의 메트릭과 의도별 평가 메트릭(*정밀도*, *재현율* 및 *F1 점수*)을 확인합니다(이 학습에서는 사용된 샘플 발화 수가 적으므로 결과에 모든 의도가 포함되지 않을 수도 있음).

    >**참고**: 평가 메트릭에 대해 자세히 알아보려면 [설명서](https://docs.microsoft.com/azure/cognitive-services/language-service/conversational-language-understanding/concepts/evaluation-metrics) 를 참조하세요.

3. **모델 배포** 페이지에서 **Clock** 모델을 선택하여 배포합니다. 다소 시간이 걸릴 수 있습니다.
4. 모델이 배포되면 **모델 테스트** 페이지에서 **Clock** 모델을 선택합니다.
5. 다음 텍스트를 입력하고 **테스트 실행**을 클릭합니다.

    `what's the time now?`

    반환되는 결과를 검토하여 예측한 의도(**GetTime**이어야 함), 그리고 모델이 예측한 의도를 대상으로 계산한 가능성을 나타내는 신뢰도 점수가 포함되어 있음을 확인합니다. JSON 탭에는 가능한 각 의도의 신뢰도를 비교한 정보가 표시됩니다(신뢰도 점수가 가장 높은 의도가 예측된 의도임).

6. 텍스트 상자의 내용을 지우고 다음 텍스트로 테스트를 한 번 더 실행합니다.

    `tell me the time`

    이번에도 예측한 의도 및 신뢰도 점수를 검토합니다.

7. 이번에는 다음 텍스트를 입력하여 테스트를 실행해 봅니다.

    `what's the day today?`

    이 경우 모델은 **GetDay** 의도를 예측해야 합니다.

## 엔터티 추가

지금까지 의도에 매핑되는 간단한 발화 몇 가지를 정의했습니다. 대다수 실제 애플리케이션에는 더 복잡한 발화가 포함됩니다. 이러한 발화에서 구체적인 데이터 엔터티를 추출하여 의도 예측을 위한 추가 컨텍스트를 수집해야 합니다.

### *학습된* 엔터티 추가

가장 흔히 사용되는 엔터티 유형은 *학습된* 엔터티입니다. 모델은 이 엔터티에서 예제를 기준으로 엔터티 값을 식별합니다.

1. Language Studio에서 **스키마 작성** 페이지로 돌아와 **엔터티** 탭에서 **&#65291; 추가**를 선택하여 새 엔터티를 추가합니다.
2. **엔터티 추가** 대화 상자에서 엔터티 이름으로 **Location**을 입력하고 **학습됨**이 선택되어 있는지 확인합니다. 그런 후에 **엔터티 추가**를 클릭합니다.
3. **Location** 엔터티가 작성되면 **스키마 작성** 페이지로 돌아온 다음 **의도** 탭에서 **GetTime** 의도를 선택합니다.
4. 다음과 같은 새 예제 발화를 입력합니다.

    `what time is it in London?`

5. 이 발화를 추가한 후 단어 ***London***을 선택합니다. 그러면 표시되는 드롭다운 목록에서 **Location**을 선택하여 "London"이 위치의 예임을 지정합니다.
6. 다른 예제 발화를 추가합니다.

    `Tell me the time in Paris?`

7. 이 발화를 추가한 후 단어 ***Paris***를 선택하여 **Location** 엔터티에 매핑합니다.
8. 다른 예제 발화를 추가합니다.

    `what's the time in New York?`

9. 이 발화를 추가한 후 단어 ***New York**을 선택하여 **Location** 엔터티에 매핑합니다.

10. **변경 내용 저장**을 클릭하여 새 발화를 저장합니다.

### *list* 엔터티 추가

엔터티의 유효한 값을 특정 단어 및 동의어 목록으로 제한할 수 있는 경우도 있습니다. 이렇게 하면 앱이 발화의 엔터티 인스턴스를 쉽게 식별할 수 있습니다.

1. Language Studio에서 **스키마 작성** 페이지로 돌아와 **엔터티** 탭에서 **&#65291; 추가**를 선택하여 새 엔터티를 추가합니다.
2. **엔터티 추가** 대화 상자에서 엔터티 이름으로 **Weekday**를 입력하고 **List** 엔터티 유형을 선택합니다. 그런 후에 **엔터티 추가**를 클릭합니다.
3. **Weekday** 엔터티 페이지의 **List** 섹션에서 **&#65291; 새 목록 추가**를 클릭합니다. 그런 후에 다음 값을 입력하고 **저장**을 클릭합니다.

    | 값 | 동의어|
    |-------------------|---------|
    | sunday | sun |

4. 이전 단계를 반복하여 다음 목록 구성 요소를 추가합니다.

    | 값 | 동의어|
    |-------------------|---------|
    | Monday | Mon |
    | Tuesday | Tue, Tues |
    | Wednesday | Wed, Weds |
    | Thursday | Thur, Thurs |
    | Friday | Fri |
    | Saturday | Sat |

5. **스키마 작성** 페이지로 돌아와 **의도** 탭에서 **GetDate** 의도를 선택합니다.
6. 다음과 같은 새 예제 발화를 입력합니다.

    `what date was it on Saturday?`

7. 이 발화를 추가한 후 단어 ***Saturday***를 선택합니다. 그러면 표시되는 드롭다운 목록에서 **Weekday**를 선택합니다.
8. 다른 예제 발화를 추가합니다.

    `what date will it be on Friday?`

9. 이 발화를 추가한 후 **Friday**를 **Weekday** 엔터티에 매핑합니다.

10. 다른 예제 발화를 추가합니다.

    `what will the be on Thurs?`

11. 이 발화를 추가한 후 **Thurs**를 **Weekday** 엔터티에 매핑합니다.

12. **변경 내용 저장**을 클릭하여 새 발화를 저장합니다.

### *미리 빌드된* 엔터티 추가

Language 서비스에서는 대화형 애플리케이션에서 흔히 사용되는 *미리 빌드된* 엔터티 집합을 제공합니다.

1. Language Studio에서 **스키마 작성** 페이지로 돌아와 **엔터티** 탭에서 **&#65291; 추가**를 선택하여 새 엔터티를 추가합니다.
2. **엔터티 추가** 대화 상자에서 엔터티 이름으로 **Date**를 입력하고 **미리 빌드된** 엔터티 유형을 선택합니다. 그런 후에 **엔터티 추가**를 클릭합니다.
3. **Date** 엔터티 페이지의 **미리 빌드됨** 섹션에서 **&#65291; 새 미리 빌드된 엔터티 추가**를 클릭합니다.
4. **미리 빌드된 엔터티 선택** 목록에서 **DateTime**을 선택하고 **저장**을 클릭합니다.
5. **스키마 작성** 페이지로 돌아와 **의도** 탭에서 **GetDay** 의도를 선택합니다.
6. 다음과 같은 새 예제 발화를 입력합니다.

    `what day was 01/01/1901?`

7. 이 발화를 추가한 후 ***01/01/1901***을 선택합니다. 그러면 표시되는 드롭다운 목록에서 **Date**를 선택합니다.
8. 다른 예제 발화를 추가합니다.

    `what day will it be on Dec 31st 2099?`

9. 이 발화를 추가한 후 **Dec 31st 2099**를 **Date** 엔터티에 매핑합니다.

10. **변경 내용 저장**을 클릭하여 새 발화를 저장합니다.

### 모델 재교육

이제 스키마를 수정했으므로 모델을 다시 학습시켜 테스트를 다시 진행해야 합니다.

1. **모델 학습** 페이지에서 기존 모델을 덮어쓰는 옵션을 선택하고 **Clock** 모델을 지정합니다. 학습 시 평가를 실행하는 옵션이 선택되어 있는지 확인하고 **학습**을 클릭하여 모델을 학습시킵니다. 기존 모델을 덮어쓸지를 묻는 메시지가 표시되면 덮어쓰기를 확인합니다.
2. 학습이 완료되면(시간이 다소 걸릴 수 있음) **모델 세부 정보 보기** 페이지를 표시하고 **Clock** 모델을 선택합니다. 그런 다음 학습 시 수행된 평가에서 생성된 *오차 행렬*, 그리고 평가 전반의 메트릭과 엔터티별, 의도별 평가 메트릭(*정밀도*, *재현율* 및 *F1 점수*)을 확인합니다(이 학습에서는 사용된 샘플 발화 수가 적으므로 결과에 모든 의도가 포함되지 않을 수도 있음).
3. **모델 배포** 페이지에서 **Clock** 모델을 선택하여 배포합니다. 다소 시간이 걸릴 수 있습니다.
4. 앱이 배포되면 **모델 테스트** 페이지에서 **Clock** 모델을 선택한 후에 다음 텍스트를 사용하여 모델을 테스트합니다.

    `what's the time in Edinburgh?`

5. 반환되는 결과를 검토합니다. 모델이 **GetTime** 의도, 그리고 텍스트 값이 "Edinburgh"인 **Location** 엔터티를 예측해야 합니다.
6. 다음 발화를 테스트해 봅니다.

    `what time is it in Tokyo?`
    
    `what date is it on Friday?`

    `what's the date on Weds?`

    `what day was 01/01/2020?`

    `what day will Mar 7th 2030 be?`

## Use the model from a client app

실제 프로젝트에서는 만족할 만한 예측 성능이 제공될 때까지 의도와 엔터티를 여러 번 미세 조정하고 모델을 다시 학습시켜 테스트를 다시 진행합니다. 테스트를 완료하여 예측 성능이 만족스러우면 모델의 REST 인터페이스를 호출하는 방식을 통해 클라이언트 앱에서 해당 모델을 사용할 수 있습니다. 이 연습에서는 *curl* 유틸리티를 사용하여 모델의 REST 엔드포인트를 호출합니다.

1. Language Studio의 **모델 배포** 페이지에서 **Clock** 모델을 선택합니다. 그런 다음 **예측 URL 가져오기**를 클릭합니다.
2. **예측 URL 가져오기** 대화 상자에는 예측 엔드포인트의 URL과 샘플 요청이 표시됩니다. 샘플 요청에는 엔드포인트에 HTTP POST 요청을 제출하는 **curl** 명령이 포함되어 있습니다. 요청의 헤더에는 Language 리소스의 키를 지정하고, 요청 데이터에는 쿼리와 언어를 포함해야 합니다.
3. 샘플 요청을 복사하여 원하는 텍스트 편집기(예: 메모장)에 붙여넣습니다.
4. 다음 자리 표시자를 아래에 나와 있는 값으로 바꿉니다.
    - **YOUR_QUERY_HERE**: *What's the time in Sydney*
    - **QUERY_LANGUAGE_HERE**: *EN*

    완성된 명령은 다음 코드와 비슷합니다.

    ```
    curl -X POST "https://some-name.cognitiveservices.azure.com/language/:analyze-conversations?projectName=Clock&deploymentName=production&api-version=2021-11-01-preview" -H "Ocp-Apim-Subscription-Key: 0ab1c23de4f56..."  -H "Apim-Request-Id: 9zy8x76wv5u43...." -H "Content-Type: application/json" -d "{\"verbose\":true,\"query\":\"What's the time in Sydney?\",\"language\":\"EN\"}"
    ```

5. 명령 프롬프트(Windows) 또는 Bash 셸(Linux/Mac)을 엽니다.
6. 편집한 curl 명령을 복사하여 명령줄 인터페이스에 붙여넣고 실행합니다.
7. 반환되는 JSON을 확인합니다. 다음과 같이 예측한 의도와 엔터티가 포함되어 있어야 합니다.

    ```
    {"query":"What's the time in Sydney?","prediction":{"topIntent":"GetTime","projectKind":"conversation","intents":[{"category":"GetTime","confidenceScore":0.9998859},{"category":"GetDate","confidenceScore":9.8372206E-05},{"category":"GetDay","confidenceScore":1.5763446E-05}],"entities":[{"category":"Location","text":"Sydney","offset":19,"length":6,"confidenceScore":1}]}}
    ```

8. 앱이 반환하는 JSON 응답을 검토합니다. 입력한 명령에 대해 예측된 점수가 가장 높은 의도(**GetTime**이어야 함)가 표시됩니다.
9. curl  명령의 쿼리를 `What's today's date?`로 변경한 후에 쿼리를 실행하여 반환되는 JSON을 검토합니다.
10. 이번에는 다음 쿼리를 실행해 봅니다.

    `What day will Jan 1st 2050 be?`

    `What time is it in Glasgow?`

    `What date will next Monday be?`

## 프로젝트 내보내기

Language Studio를 사용하면 Language Understanding 모델을 개발하고 테스트할 수 있습니다. 그러나 DevOps용 소프트웨어 개발 프로세스에서는 CI/CD(연속 통합 및 지속적인 업데이트) 파이프라인에 포함할 수 있는 프로젝트의 원본 제어 정의를 유지 관리해야 합니다. 코드 스크립트에서 Language REST API를 사용하여 모델을 만들고 학습시킬 수도 *있습니다*. 하지만 포털을 사용하여 모델을 만든 후에 다른 Language 서비스 인스턴스에서 가져와 다시 학습시킬 수 있는 *[.json]* 파일로 내보내는 방식이 더 간편합니다. 이 방식을 사용하면 생산성이 우수한 Language Studio 시각적 인터페이스를 활용하는 동시에 모델의 이동성과 재현 가능성도 유지할 수 있습니다.

1. Language Studio의 **프로젝트** 페이지에서 **Clock(대화)** 프로젝트를 선택합니다.
2. **&#x2913; 내보내기** 단추를 클릭합니다.
3. 생성된 **Clock.json** 파일을 원하는 위치에 저장합니다.
4. 다운로드한 파일을 원하는 코드 편집기(예: Visual Studio Code)에서 열어 프로젝트의 JSON 정의를 검토합니다.

## 자세한 정보

**Language** 서비스를 사용하여 대화형 Language Understanding 솔루션을 만드는 방법에 대한 자세한 내용은 [Language 서비스 설명서](https://docs.microsoft.com/azure/cognitive-services/language-service/conversational-language-understanding/overview) 를 참조하세요.
